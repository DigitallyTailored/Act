(()=>{var n={_uid_val:0,_views:{},target:!1,load(e){let t=e.map(c=>import(c[1]).then(i=>{this._views[c[0]]=i.default}));return Promise.all(t)},render(e,t=!1,c=!0,i=!0){t=t||this.target,c&&this.clearTarget(t),Array.isArray(e)||(e=[e]);let r=this.processElements(e,t,i);this.runScriptsAndCreateEventListeners(r)},clearTarget(e){for(;e?.firstChild;)e.removeChild(e.firstChild)},processElements(e,t,c){let i=[];return e.forEach(r=>{if(typeof r=="string"||typeof r=="number")t.insertAdjacentHTML(c?"beforeend":"afterbegin",r);else{t.insertAdjacentElement(c?"beforeend":"afterbegin",r);let s=r.act.values(),a=this._views[s.act.viewName];s.act.parent=()=>t,this.setStyle(a,s),i.push(r),this.processWatches(r,s),s?.body&&this.render(s.body,r.querySelector("act-body"))}}),i},setStyle(e,t){if(e.style&&!this.target.querySelector(`style[data-act_style="${t.act.viewName}"]`)){let c=document.createElement("style");c.dataset.act_style=t.act.viewName;let i=e.style(t);i=i.replace(/([\w\d.#]+)(\s*\{)/g,(r,s,a)=>`${s}${t.act.style} ${a}
`),c.innerHTML=i,this.target.insertAdjacentElement("afterbegin",c)}},processWatches(e,t){e.querySelectorAll("act-watch").forEach(i=>{let r=t.act._watchers[i.dataset.act_watch_key];act.listen(r.name,s=>{i.innerText=r.event(t)}),i.innerText=r.event(t)})},runScriptsAndCreateEventListeners(e){for(let t=0;t<e.length;t++){let c=e[t],i=c.act.values(),r=this._views[i.act.viewName];r?.script&&r.script(i),i?.on&&this.createEventListeners(c,i)}},createEventListeners(e,t){let c=t.on;Array.isArray(c)||(c=[c]);for(let i=0;i<c.length;i++){let r=Object.keys(c[i])[0],s=c[i][r];e.addEventListener(r,a=>{s(a,t)})}},view(e,t={}){this._views[e]?.values&&(t={on:[],...this._views[e].values(t),...t}),t.act={},t.act.viewName=e,t.act.view=`[data-act_view="${t.act.viewName}"]`,t.act.style=`[data-act_style="${t.act.viewName}"]`,t.act._uid=this.uid();let c=this._views[e],i=document.createElement("div");t.act._watchers=[],t.watch=(s,a=null)=>(a===null&&(a=s,s="*"),t.act._watchers.push({name:s,event:a}),`<act-watch data-act_watch="${s}" data-act_watch_key="${t.act._watchers.length-1}"></act-watch>`),t?.body&&(t.act._body=t.body,t.body="<act-body></act-body>"),i.innerHTML=c.view(t),t?.body&&(t.body=t.act._body,delete t.act._body);let r=i.querySelectorAll("*");for(let s=0;s<r.length;s++)r[s].setAttribute("data-act_style",e);return i=i.children[0],i.act={},i.act.values=()=>t,t.act.element=i,t.act.reference=s=>i.act.find("act-"+s),i.classList.add(t.act._uid),i.dataset.act_view=e,t.act.append=(s,a)=>this.append(a,s),t.act.find=s=>i.querySelector(s),t.act.findAll=s=>i.querySelectorAll(s),t.act.findView=s=>i.querySelector(`[data-act_view="${s}"]`),t.act.findViews=s=>i.querySelectorAll(`[data-act_view="${s}"]`),i},uid(){return this._uid_val++,"act_uid_"+this._uid_val},prepend(e,t){this.render(e,t,!1,!1)},append(e,t){this.render(e,t,!1)}};var d={state:{},listeners:new Set,listenersSpecific:[],get(){return this.state},init(e){let t=Object.keys(e).reduce((c,i)=>(this.state[i]!==e[i]&&(c[i]=e[i]),c),{});return this.state={...this.state,...e},t},set(e){let t=this.init(e);Object.keys(t).forEach(c=>{this.listenersSpecific[c]&&this.listenersSpecific[c].forEach(i=>{i(this.state)})}),this.listeners.forEach(c=>c(this.state))},listen(e,t=null){t==null?(t=e,this.listeners.add(t)):(this.listenersSpecific[e]||(this.listenersSpecific[e]=new Set),this.listenersSpecific[e].add(t))},ignore(e,t=null){t==null?(t=e,this.listeners.delete(t)):this.listenersSpecific[e]&&(this.listenersSpecific[e]=this.listenersSpecific[e].filter(c=>c!==t))}};window.act={test:()=>{console.log("test 5")},...n,...d};window.a=window.act;})();
