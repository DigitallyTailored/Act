(()=>{var n={_uid_val:0,_views:{},target:!1,import(e){Object.keys(e).forEach(t=>{this._views[t]=e[t]})},render(e,t=!1,r=!0,i=!0){t=t||this.target,r&&this.clearTarget(t),Array.isArray(e)||(e=[e]);let s=this.processElements(e,t,i);this.runScriptsAndCreateEventListeners(s)},clearTarget(e){for(;e?.firstChild;)e.removeChild(e.firstChild)},processElements(e,t,r){let i=[];return e.forEach(s=>{if(typeof s=="string"||typeof s=="number")t.insertAdjacentHTML(r?"beforeend":"afterbegin",s);else{t.insertAdjacentElement(r?"beforeend":"afterbegin",s);let c=s.act.values(),a=this._views[c.act.viewName];c.act.parent=()=>t,this.setStyle(a,c),i.push(s),this.processWatches(s,c),c?.body&&this.render(c.body,s.querySelector("act-body"))}}),i},setStyle(e,t){if(e.style&&!this.target.querySelector(`style[data-act_style="${t.act.viewName}"]`)){let r=document.createElement("style");r.dataset.act_style=t.act.viewName;let i=e.style(t);i=i.replace(/([\w\d.#]+)(\s*\{)/g,(s,c,a)=>`${c}${t.act.style} ${a}
`),r.innerHTML=i,this.target.insertAdjacentElement("afterbegin",r)}},processWatches(e,t){e.querySelectorAll("act-watch").forEach(i=>{let s=t.act._watchers[i.dataset.act_watch_key];act.watch(s.name,c=>{i.innerText=s.event(t)}),i.innerText=s.event(t)})},runScriptsAndCreateEventListeners(e){for(let t=0;t<e.length;t++){let r=e[t],i=r.act.values(),s=this._views[i.act.viewName];s?.script&&s.script(i),i?.on&&this.createEventListeners(r,i)}},createEventListeners(e,t){let r=t.on;Array.isArray(r)||(r=[r]);for(let i=0;i<r.length;i++){let s=Object.keys(r[i])[0],c=r[i][s];e.addEventListener(s,a=>{c(a,t)})}},view(e,t={}){this._views[e]?.values&&(t={...this._views[e].values(t),...t}),this._views[e].values?.on||(t={on:[],...t}),t.act={},t.act.viewName=e,t.act.view=`[data-act_view="${t.act.viewName}"]`,t.act.style=`[data-act_style="${t.act.viewName}"]`,t.act._uid=this.uid();let r=this._views[e],i=document.createElement("div");t.act._watchers=[],t.watch=(c,a=null)=>(a===null&&(a=c,c="*"),t.act._watchers.push({name:c,event:a}),`<act-watch data-act_watch="${c}" data-act_watch_key="${t.act._watchers.length-1}"></act-watch>`),t?.body&&(t.act._body=t.body,t.body="<act-body></act-body>"),i.innerHTML=r.view(t),t?.body&&(t.body=t.act._body,delete t.act._body);let s=i.querySelectorAll("*");for(let c=0;c<s.length;c++)s[c].setAttribute("data-act_style",e);return i=i.children[0],i.act={},i.act.values=()=>t,t.act.element=i,t.act.reference=c=>i.act.find("act-"+c),i.classList.add(t.act._uid),i.dataset.act_view=e,t.act.append=(c,a)=>this.append(a,c),t.act.find=c=>i.querySelector(c),t.act.findAll=c=>i.querySelectorAll(c),t.act.findView=c=>i.querySelector(`[data-act_view="${c}"]`),t.act.findViews=c=>i.querySelectorAll(`[data-act_view="${c}"]`),i},uid(){return this._uid_val++,"act_uid_"+this._uid_val},prepend(e,t){this.render(e,t,!1,!1)},append(e,t){this.render(e,t,!1)}};var h={state:{},listeners:new Set,listenersSpecific:[],get(){return this.state},init(e){let t=Object.keys(e).reduce((r,i)=>(this.state[i]!==e[i]&&(r[i]=e[i]),r),{});return this.state={...this.state,...e},t},set(e){let t=this.init(e);Object.keys(t).forEach(r=>{this.listenersSpecific[r]&&this.listenersSpecific[r].forEach(i=>{i(this.state)})}),this.listeners.forEach(r=>r(this.state))},watch(e,t=null){t==null?(t=e,this.listeners.add(t)):(this.listenersSpecific[e]||(this.listenersSpecific[e]=new Set),this.listenersSpecific[e].add(t))},ignore(e,t=null){t==null?(t=e,this.listeners.delete(t)):this.listenersSpecific[e]&&(this.listenersSpecific[e]=this.listenersSpecific[e].filter(r=>r!==t))}};var d="0.3";window.act={version:()=>{console.log(`Act ${d} - https://github.com/DigitallyTailored/Act`)},...n,...h};})();
