(()=>{var n={_uid_val:0,_views:{},target:!1,import(e){Object.keys(e).forEach(t=>{this._views[t]=e[t]})},render(e,t=!1,s=!0,i=!0){t=t||this.target,s&&this.clearTarget(t),Array.isArray(e)||(e=[e]);let r=this.processElements(e,t,i);this.runScriptsAndCreateEventListeners(r)},clearTarget(e){for(;e?.firstChild;)e.removeChild(e.firstChild)},processElements(e,t,s){let i=[];return e.forEach(r=>{if(typeof r=="string"||typeof r=="number")t.insertAdjacentHTML(s?"beforeend":"afterbegin",r);else{t.insertAdjacentElement(s?"beforeend":"afterbegin",r);let c=r.act.values(),a=this._views[c.act.viewName];c.act.parent=()=>t,this.setStyle(a,c),i.push(r),this.processWatches(r,c),c?.body&&this.render(c.body,r.querySelector("act-body"))}}),i},setStyle(e,t){if(e.style&&!this.target.querySelector(`style[data-act_style="${t.act.viewName}"]`)){let s=document.createElement("style");s.dataset.act_style=t.act.viewName;let i=e.style(t);i=i.replace(/([\w\d.#]+)(\s*\{)/g,(r,c,a)=>`${c}${t.act.style} ${a}
`),s.innerHTML=i,this.target.insertAdjacentElement("afterbegin",s)}},processWatches(e,t){e.querySelectorAll("act-watch").forEach(i=>{let r=t.act._watchers[i.dataset.act_watch_key];act.listen(r.name,c=>{i.innerText=r.event(t)}),i.innerText=r.event(t)})},runScriptsAndCreateEventListeners(e){for(let t=0;t<e.length;t++){let s=e[t],i=s.act.values(),r=this._views[i.act.viewName];r?.script&&r.script(i),i?.on&&this.createEventListeners(s,i)}},createEventListeners(e,t){let s=t.on;Array.isArray(s)||(s=[s]);for(let i=0;i<s.length;i++){let r=Object.keys(s[i])[0],c=s[i][r];e.addEventListener(r,a=>{c(a,t)})}},view(e,t={}){this._views[e]?.values&&(t={on:[],...this._views[e].values(t),...t}),t.act={},t.act.viewName=e,t.act.view=`[data-act_view="${t.act.viewName}"]`,t.act.style=`[data-act_style="${t.act.viewName}"]`,t.act._uid=this.uid();let s=this._views[e],i=document.createElement("div");t.act._watchers=[],t.watch=(c,a=null)=>(a===null&&(a=c,c="*"),t.act._watchers.push({name:c,event:a}),`<act-watch data-act_watch="${c}" data-act_watch_key="${t.act._watchers.length-1}"></act-watch>`),t?.body&&(t.act._body=t.body,t.body="<act-body></act-body>"),i.innerHTML=s.view(t),t?.body&&(t.body=t.act._body,delete t.act._body);let r=i.querySelectorAll("*");for(let c=0;c<r.length;c++)r[c].setAttribute("data-act_style",e);return i=i.children[0],i.act={},i.act.values=()=>t,t.act.element=i,t.act.reference=c=>i.act.find("act-"+c),i.classList.add(t.act._uid),i.dataset.act_view=e,t.act.append=(c,a)=>this.append(a,c),t.act.find=c=>i.querySelector(c),t.act.findAll=c=>i.querySelectorAll(c),t.act.findView=c=>i.querySelector(`[data-act_view="${c}"]`),t.act.findViews=c=>i.querySelectorAll(`[data-act_view="${c}"]`),i},uid(){return this._uid_val++,"act_uid_"+this._uid_val},prepend(e,t){this.render(e,t,!1,!1)},append(e,t){this.render(e,t,!1)}};var d={state:{},listeners:new Set,listenersSpecific:[],get(){return this.state},init(e){let t=Object.keys(e).reduce((s,i)=>(this.state[i]!==e[i]&&(s[i]=e[i]),s),{});return this.state={...this.state,...e},t},set(e){let t=this.init(e);Object.keys(t).forEach(s=>{this.listenersSpecific[s]&&this.listenersSpecific[s].forEach(i=>{i(this.state)})}),this.listeners.forEach(s=>s(this.state))},listen(e,t=null){t==null?(t=e,this.listeners.add(t)):(this.listenersSpecific[e]||(this.listenersSpecific[e]=new Set),this.listenersSpecific[e].add(t))},ignore(e,t=null){t==null?(t=e,this.listeners.delete(t)):this.listenersSpecific[e]&&(this.listenersSpecific[e]=this.listenersSpecific[e].filter(s=>s!==t))}};window.act={loadTest:e=>{console.trace(e)},test:()=>{console.log("test 5")},...n,...d};window.a=window.act;})();
